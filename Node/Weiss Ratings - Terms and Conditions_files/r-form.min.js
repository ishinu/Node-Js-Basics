(function(n){function e(u,f){var o=this,e=u.ratFindIncludeSelf("form"),l=e.ratFindIncludeSelf(".r-busy-container"),h,s=n.extend({ajaxEnabled:!0,restoreUiOnSuccess:!0},f),w=!1,y=!1,a=!1,c,v,p;l.length===0&&(l=e.closest(".r-busy-container"));n.extend(o,{init:function(){var i,f,h,l,a,r;if(!w){w=!0;e.data("unobtrusiveValidation")||n.validator.unobtrusive.parse(document);typeof s.busy!="object"&&(i={},f=u.data("busy-fill"),typeof f=="boolean"&&(i.fill=f),h=u.data("busy-translucent"),typeof h=="boolean"&&(i.translucent=h),l=u.data("busy-inline"),typeof l=="boolean"&&(i.inline=l),a=u.data("busy-message"),typeof a=="string"&&(i.message=a),Object.keys(i).length&&(s.busy=i));u.find(".r-submit").click(function(t){t.stopPropagation();t.preventDefault();c=n(t.target).closest(".r-submit");e.submit()});e.on("submit",o.onSubmit).on("invalid-form",o.onInvalidForm);e.find("input[type='submit'], button[type='submit']").on("click",o.onSubmitButtonClick);if(r=e.validate(),r.settings.focusInvalid=!0,r.settings.onkeyup=null,r.settings.ignore=".r-hidden, .r-client-pass, .r-ignore",r.settings.submitHandler=n.proxy(o.onSubmitHandler,o),e.attr("data-ajax-begin","$.fn.ratForm._onAjaxBegin"),e.attr("data-ajax-success","$.fn.ratForm._onAjaxSuccess"),e.attr("data-ajax-complete","$.fn.ratForm._onAjaxComplete"),e.data("unobtrusiveValidation")||n.validator.unobtrusive.parse(document),e.data("unobtrusiveValidation")&&(e.data("unobtrusiveValidation").validate=function(){var n=e.validate();return e.valid()?n.pendingRequest>0?(n.formSubmitted=!0,!1):!0:!1}),s.autoEnable){v=e.find("input[data-auto-enable='true'], select[data-auto-enable='true']");v.on("blur keyup change click mouseup",o.onAutoEnableTrack)}(s.autofocus===!0||s.initFocus!==!1&&t&&!e.hasClass("r-no-auto-focus")&&e.find("[autofocus]").length===0)&&setTimeout(o.focusFirstInput,50);t=!1}},initLabelPlaceholder:function(){if(e.is(".r-label-placeholder")){var t=e.find(".r-input[type='text'],.r-input[type='email'],.r-input[type='number'],.r-input[type='password'],.r-input[type='date']");setTimeout(function(){t.each(function(t,i){var r=n(i);r.is(":focus")&&r.closest(".r-editor").addClass("r-focus");(r.val().length>0||r.ratIsAutofill())&&r.closest(".r-editor").addClass("r-has-value")})},0);t.on("focus",function(t){n(t.target).closest(".r-editor").addClass("r-focus")}).on("blur",function(t){n(t.target).closest(".r-editor").removeClass("r-focus")}).on("change",function(t){var i=n(t.target);i.closest(".r-editor")[i.val().length>0?"addClass":"removeClass"]("r-has-value")})}},destroy:function(){e.off("submit",o.onSubmit).off("invalid-form",o.onInvalidForm);e.find("input[type='submit'], button[type='submit']").off("click",o.onSubmitButtonClick);v&&v.off("blur keyup change click mouseup",o.onAutoEnableTrack);u.data("ratForm",null)},form:function(){return e},buttonClicked:function(){return c},options:function(){return s},submit:function(){return e.submit()},validate:function(){return e.validate()},valid:function(){return e.valid()},resetForm:function(){return e.find(".field-validation-error").removeClass("field-validation-error").addClass("field-validation-valid"),e.find(".r-message.r-error").hide(),e.find(".r-editor-recaptcha input[type='hidden']").val(""),e.find("input").each(function(t,i){var r=n(i),u=r.attr("value");u!==undefined&&r.val(u)}),e.validate().resetForm()},isDirty:function(){var t=!1;return e.find("input:not(.r-no-track)").each(function(i,r){var u=n(r);return u.ratIsAutofill()||(u.attr("value")||"")!==u.val()?(t=!0,!1):!0}),t&&(p=!1),t},getJSON:function(){o.onUpdateEditorValues();var t={},i=jQuery.makeArray(e.prop("elements"));return n.each(i,function(i,r){if(typeof r.name!="undefined"&&r.name){var u=n(r);u.is(":submit")||t[r.name]&&u.is("input[type='hidden']")||r.name&&!u.hasClass("r-no-post")&&(t[r.name]=u.is("input:checkbox")?u.is(":checked"):u.val())}}),s.appendQueryString&&typeof s.appendQueryString=="string"&&(t[s.appendQueryString]=n.rat.getQuerystring(s.appendQueryString)||null),s.appendQueryStringPath&&typeof s.appendQueryStringPath=="string"&&!t[s.appendQueryStringPath]&&(t[s.appendQueryStringPath]=window.location.pathname),t},focusFirstInput:function(n){e.ratFocusFirstInput(n)},focusInvalid:function(){var n=e.find(".input-validation-error").filter(":input:not([readonly='readonly']):visible:enabled:first"),t;if(n.length){n.focus();n.ratScrollToBottom(-20);return}(t=e.find(".validation-summary-errors"),t.length)&&t.ratScrollToBottom(-5)},handleResult:function(t,i){if(t&&(a=t.success!==!1,t.success===!1&&(i=!0),i===!0?t.success=!1:e.find("input").each(function(t,i){var r=n(i);r.attr("value",r.val())}),!s.onAjaxResult||s.onAjaxResult(t,o)!==!1)&&(i===!0||typeof s.onAjaxSuccess!="function"||s.onAjaxSuccess.call(o,t)!==!1)){a&&t.refreshPage&&(s.restoreUiOnSuccess=!1);var r=function(){var u,r,f;if(typeof t=="string"&&(u=e.ratFindIncludeSelf(".r-replace-content"),u.length===0&&(u=e.closest(".r-replace-content")),u.length===1)){u.ratEmpty().prepend(t);u.find(".r-ajax-script").each(function(t,i){var u,r,f;try{u=n(i);r=u.html();typeof r=="string"&&(f=new Function(r),f())}catch(e){}});return}if(typeof t.url=="string"){s.restoreUiOnSuccess=!1;window.location.pathname===t.url?window.location=n.rat.setQuerystring("nc",""+(Math.floor(Math.random()*26)+Date.now()),window.location.href):n.ratObjects.view&&!t.refreshPage?n.ratObjects.view.navigate(t.url):location.href=t.url;return}r=t.updateContainer?e.ratFindIncludeSelf(t.updateContainer):e.find("> .r-message");r.length!==0||Array.isArray(t.modelState)||e.prepend(r=n("<div class='alert r-message'><\/div>"));f=function(){var u,e,f;if(!o.showModelStateErrors(t,r,!0)){if(u=typeof t=="string"?t:t.html||t.message,typeof u=="string"){u=u.trim();e=!1;try{f=n(u);(t.updateContainer&&f.hasClass(t.updateContainer.substring(1))||r.is("form"))&&(r.replaceWith(f.hide()),r=f,e=!0)}catch(s){}e||r.empty().append(u.trim()||"Unknown error.");i!==!0||r.hasClass("r-error")?i===!0||t.info!==!0||r.hasClass("r-info")?r.removeClass("r-hidden"):(r.is(":not([class^='r-message'],[class*=' r-message'])")&&r.addClass("r-message"),r.removeClass("r-error r-hidden").addClass("alert-info r-info")):(r.is(":not([class^='r-message'],[class*=' r-message'])")&&r.addClass("r-message"),r.removeClass("r-info r-hidden").addClass("alert-danger r-error"));r.ratScrollToTop();typeof t.startupScript=="string"&&eval(t.startupScript)}r.fadeIn()}};r.is(":visible")&&r.html()?r.fadeOut(f):f();a=i===!0?!1:t.success;!a&&h&&h.length&&(e.find(".r-editor-recaptcha input[type='hidden']").val(""),grecaptcha.reset(h._recaptchaId))};typeof t.abandon=="boolean"?n.ratAnalytics.abandon(t.abandon,function(){r()}):r()}},showModelStateErrors:function(t,i,r){var u,f,h,s;if(!Array.isArray(t.modelState))return!1;if(r!==!1&&(r=!0),u=null,f=null,r){if(u=n("[data-valmsg-summary=true]"),u.length===0&&(u=n("[data-errors-summary=true]")),u.length===0&&(u=i),!u)return!1;u.empty();f=n("<ul>").appendTo(u)}for(h=0;h<t.modelState.length;h++){if(s=t.modelState[h],!s.name){u&&f&&(u.addClass("validation-summary-errors").removeClass("validation-summary-valid"),n("<li>").html(s.error||"").appendTo(f));continue}var c=s.name.replace(/[.]/g,"_"),l=e.find("#"+c),a=e.find("[data-valmsg-for='"+s.name+"']"),v=n("<span><\/span>").attr("for",c).html(s.error||"");l.addClass("input-validation-error");a.removeClass("field-validation-valid").addClass("field-validation-error").empty().append(v)}return f&&(f.children().length>0?(i.is(":not(.validation-summary-valid)")&&i.addClass("r-message").addClass("r-error"),i.removeClass("r-hidden")):f.remove()),setTimeout(function(){o.blinkErrors();o.focusInvalid()},0),!0},blinkErrors:function(){e.find(".validation-summary-errors").ratBlink();e.find(".field-validation-error").ratBlink()},onUpdateEditorValues:function(){p||(p=!0,window.tinyMCE&&window.tinyMCE.triggerSave(),n("input:checkbox").each(function(){n("input:hidden[name='"+n(this).attr("name")+"']").val(n(this).is(":checked"))}),this.form().trigger("SaveChanges"))},onSubmitHandler:function(){return o.onUpdateEditorValues(),!0},onSubmit:function(t){var r,u,f,i;if(y)throw"Invalid call, form already submitting.";if(s.ajaxEnabled&&t.preventDefault(),r=c?c.data("ajax-validate"):!0,typeof r!="boolean"&&(r=!0),r){if(typeof s.onNotDirty=="function"&&o.isDirty()===!1&&s.onNotDirty.call(o,t)===!1)return;if(u=e.validate(),e.valid()){if(u.pendingRequest){u.formSubmitted=!0;s.ajaxEnabled&&s.busy!==!1&&l.ratBusy(n.extend({message:T("Processing..."),fill:!0,translucent:!0},s.busy||{}));return}}else{setTimeout(function(){o.focusInvalid()},25);l.ratBusy(!1);return}}if(f=c?c.attr("data-confirm-message"):null,typeof f=="string"&&confirm(f)!==!0){t.preventDefault();return}if(s.ajaxEnabled&&(typeof s.onSaveChanges!="function"||s.onSaveChanges.call(o)!==!1)){if(i=o.getJSON(),c&&c.length&&c[0].name&&(i.submit=c[0].name,i[c[0].name]=!0),typeof s.onPostData=="function")s.onPostData(i);(typeof s.onSubmit!="function"||s.onSubmit.call(o,t,i)!==!1)&&o._onAjaxBegin()&&n.ajax({url:e.prop("action"),cache:!1,type:e.data("ajax-method")||"POST",dataType:s.dataType||e.data("ajax-data-type")||undefined,data:jQuery.param(i),success:function(n){o._onAjaxReceived(n,!1);n&&n.success!==!1?o._onAjaxSuccess(n):o._onAjaxError(n);o._onAjaxComplete(o)},error:function(t){o._onAjaxReceived(t,!0);o._onAjaxError(n.rat.errorMessage(t));o._onAjaxComplete()}})}},onSubmitButtonClick:function(t){c=n(t.target);o.onSubmit(t)},onAutoEnableTrack:function(){setTimeout(function(){var t=!1;v.each(function(i,r){var u=n(r),f=typeof u[0].defaultValue!="undefined"?u[0].defaultValue:u.is("select")?n(this).find("option").filter(function(){return n(this).prop("defaultSelected")}).val():null,e,o;return f==null?t=!0:(e=n.trim(f),o=n.trim(u.val()),t=e!==o),!t});e.find("input[type='submit']").prop("disabled",!t)},0)},onInvalidForm:function(){var t=c?c.data("ajax-validate"):!0,n;if(t===!1){o.resetForm();return}(n=(new Date).getTime()/1e3,n-(e.ratLastInvalidForm||0)<1)||(e.ratLastInvalidForm=n,setTimeout(function(){l.ratBusy(!1);s.blinkErrors!==!1&&o.blinkErrors();o.focusInvalid()},0))},_onAjaxBegin:function(){var t=typeof s.onAjaxBegin=="function"?s.onAjaxBegin(o):!0;return t===!1?!1:(y=t!==!1,o._enabledElements=e.find("input:not(:disabled), button:not(:disabled), select:not(:disabled)").attr("disabled","disabled"),s.busy!==!1&&l.ratBusy(n.extend({message:T("Processing..."),fill:!0,translucent:!0},s.busy||{})),y)},_onAjaxReceived:function(n,t){if(s.onAjaxReceived)s.onAjaxReceived(o,n,t)},_onAjaxError:function(n){if(o._enabledElements&&(o._enabledElements.removeAttr("disabled"),delete o._enabledElements),typeof s.onAjaxError=="function")s.onAjaxError(o,n);else o.handleResult(n,!0)},_onAjaxComplete:function(){if(o._enabledElements&&(o._enabledElements.removeAttr("disabled"),delete o._enabledElements),p=!1,s.onAjaxComplete)s.onAjaxComplete(o);(y=!1,a!==!0||s.restoreUiOnSuccess!==!1)&&(s.busy!==!1&&l.ratBusy(!1),e.validate().settings.onfocusout=!1,a===!0&&s.autoEnable&&(e.find("input[data-auto-enable='true']").each(function(t,i){i.defaultValue=n(i).val()}),e.find("input[type='submit']").prop("disabled",!0)),a===!0&&e.find(".validation-summary-errors").hide())},_onAjaxSuccess:function(n){o.handleResult(n)},recaptcha:function(){(h=e.find(".r-recaptcha"),h.length&&!h.data("recaptcha-init"))&&(window.ratRecaptchaForm=this,i?r&&this.recaptchaReady():(i=!0,n("head script").last().after("<script src='https://www.google.com/recaptcha/api.js?onload=ratRecaptchaLoad&render=explicit' type='text/javascript'><\/script>")))},recaptchaReady:function(){var i,t,r;h&&h.length&&(delete window.ratRecaptchaForm,i={sitekey:h.data("sitekey"),callback:n.proxy(o.recaptchaCallback,o),"expired-callback":n.proxy(o.recaptchaExpiredCallback,o),theme:"light"},t=parseInt(h.data("tabindex")),typeof t!="number"||isNaN(t)||(i.tabindex=t),r=n("<div class='r-wrap'>").appendTo(h),h._recaptchaId=grecaptcha.render(r[0],i),h.ratBusy(!1),h.data("recaptcha-init",!0))},recaptchaCallback:function(n){var t=h.closest(".r-editor");t.find("input[type='hidden']").val(n);t.find(".field-validation-error").length&&e.valid()},recaptchaExpiredCallback:function(){h.closest(".r-editor").find("input[type='hidden']").val("");e.valid()}});o.init();o.initLabelPlaceholder();o.recaptcha();o.resetForm()}var t=!0,i=!1,r=!1,f=n.validator.methods.email,u;n.validator.methods.email=function(){return arguments.length>0&&(arguments[0]=n.trim(arguments[0])),f.apply(this,arguments)};u=n.validator.methods.equalTo;n.validator.methods.equalTo=function(){var t=n(arguments[1]),i=n(arguments[2]),r,f;return t.is(":checkbox")||i.is(":checkbox")?(r=t.is(":checkbox")?t.is(":checked"):t.val().toLowerCase()==="true",f=i.is(":checkbox")?i.is(":checked"):i.val().toLowerCase()==="true",r===f):u.apply(this,arguments)};n.fn.ratForm=function(t){return this.each(function(){var r=n(this),i=r.data("ratForm");t==="destroy"?i&&i.destroy():i?i.resetForm():(i=new e(r,t),r.data("ratForm",i))}),this};n.extend(n.fn.ratForm,{_onAjaxBegin:function(){var t=n.rat.formWithAction(this.action).data("ratForm");return t?t._onAjaxBegin():!1},_onAjaxComplete:function(){var t=n.rat.formWithAction(this.action).data("ratForm");t&&t._onAjaxComplete()},_onAjaxSuccess:function(t){var i=n.rat.formWithAction(this.action).data("ratForm");i&&i._onAjaxSuccess(t)}});window.ratRecaptchaLoad=function(){r=!0;window.ratRecaptchaForm.recaptchaReady()}})(jQuery);